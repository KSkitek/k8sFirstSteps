<!DOCTYPE html>
<html>
  <head>
    <title>k8s First Steps</title>
    <meta charset="utf-8"/>
    <link rel="stylesheet" href="slides.css"/>
  </head>
  <body>
    <textarea id="source">
name: inverse
layout: true
class: center, middle, inverse
---
# Kubernetes first steps

.footnote[http://github.com/KSkitek/k8sFirstSteps]
???
* I work at PSI
* I wanted to introduce k8s to my team. I will try to introduce anyone who is willing to listen ;)
* I don't really have k8s production experience (yet)

---
layout: false
# Simple-complex app

![](app-arch.svg)

---
# What is kubernetes?

[Kubernetes](kubernetes.io) is an open-source system for automating deployment, scaling, and management of containerized applications.

Not an orchestrator but rather an controller, 
  a manager of containers that promisses to keep desired state of containers configuration.

![](ui-dashboard-node.png.jpg)

---
# Contenerization - Docker

```Dockerfile
FROM scratch

EXPOSE 8080

COPY k8sFirstSteps-linux /usr/bin/app
ENTRYPOINT [ "/usr/bin/app", "8080" ]
```

---
# Create a k8s cluster

```bash
gcloud beta container clusters create "cluster-1"
  --machine-type "g1-small"
  --preemptible
  --num-nodes "3"
```

---
# The "real" command

```bash
gcloud beta container clusters create "cluster-1"
  --machine-type "g1-small"
  --preemptible
  --num-nodes "3"
  --enable-cloud-logging
  --disk-size "10"
  --cluster-version "1.9.6-gke.0"
  --username "admin"
  --scopes "https://www.googleapis.com/auth/compute","https://www.googleapis.com/auth/devstorage.read_only","https://www.googleapis.com/auth/logging.write","https://www.googleapis.com/auth/monitoring","https://www.googleapis.com/auth/servicecontrol","https://www.googleapis.com/auth/service.management.readonly","https://www.googleapis.com/auth/trace.append"
  --enable-cloud-monitoring 
  --addons HorizontalPodAutoscaling,HttpLoadBalancing,KubernetesDashboard
```
???
```
gcloud beta container clusters create "cluster-1" --machine-type "g1-small" --preemptible --num-nodes "3" --enable-cloud-logging --disk-size "10" --cluster-version "1.9.6-gke.0" --username "admin" --scopes "https://www.googleapis.com/auth/compute","https://www.googleapis.com/auth/devstorage.read_only","https://www.googleapis.com/auth/logging.write","https://www.googleapis.com/auth/monitoring","https://www.googleapis.com/auth/servicecontrol","https://www.googleapis.com/auth/service.management.readonly","https://www.googleapis.com/auth/trace.append" --enable-cloud-monitoring  --addons HorizontalPodAutoscaling,HttpLoadBalancing,KubernetesDashboard
```

---
# Start using the cluster

```bash
gcloud container clusters get-credentials test1
make dpush
kubectl run k8sfs --image eu.gcr.io/jugpoznan2018/k8sfirststeps
kubectl get all
```
???
```
gcloud container clusters get-credentials test1
make dpush
kubectl run k8sfs --image eu.gcr.io/jugpoznan2018/k8sfirststeps
kubectl get all
```

---
# k8s deployment building blocks

* Containers under the hood
* Workloads-Pod
* Controllers
* Service
* Storage
* Configuration & Administration

.footnote[https://kubernetes.io/docs/concepts/]
---
# Pod

![](pod.jpg)

---
# Pod

Basic building block. A logically grouped collection of containers.

Usually you don't create it by yourself. 

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: httpcmd
spec:
  containers:
  - name: httpcmd
    image: registry.gitlab.com/kskitek/httpcmd:latest
  imagePullSecrets:
  - name: gitlab
```

---
# Controllers

* Deployments
* ReplicaSets
* ReplicationControllers
* StatefulSets
* DaemonSet
* CronJobs

???
You describe a desired state in a Deployment 

Pod + ReplicaSet ~= Deployment
```bash
kubectl rollout history
kubectl rollout undo
kubectl scale deployment
kubectl set image
```

---
# Storage

* Volumes
* PersistentVolumes

???

Volumes in Docker are just directories..

In k8s Volume lives inside Pod. Kill a container (Deployment) inside 

---
# Secrets

```bash
kubectl create secret docker-registry gitlab
 --docker-server=registry.gitlab.com
 --docker-username=kskitek
 --docker-email=krzysztof.skitek@gmail.com
 --docker-password=???
```

???
Administration & Configuration

Also:
* ConfigMaps
* Labels
* Proxy
* Device Plugins (GPUs, TPUs, RDMA)
* Certificates, Auth, Authorization
* Metrics and Auditing

---
# Contenerization - docker-compose
.left-column[
```yaml
version: '3'
services:
  influx:
    image: influxdb
    ports:
      - 8086:8086
    deploy:
      resources:
        limits:
          memory: 100M
    environment:
      - INFLUXDB_DB=mes
  
  chronograf:
    image: chronograf
    ports:
      - 8888:8888
    deploy:
      resources:
        limits:
          memory: 50M
```
]
.right-column[
```yaml
  generator:
    image: eu.gcr.io/jug/k8sfs:0.1
    ports:
      - 8080:8080
    deploy:
      resources:
        limits:
          memory: 5M
    depends_on:
      - influx










_
```
]

---
# kompose.io

```bash
kompose convert -f docker-compose.yaml
```

???
```bash
kubectl delete
watch kubectl get po,deploy,svc
kompose convert
kubectl apply
kubectl get all
Add Type: LoadBalancer
http :8080/set/20 /asdf /-20
# kubectl delete svc,deploy -l io.kompose.service
git checkout negative-values
kubectl label color blue
make dpush
kubectl apply
```

---
# Honorable mentions

* minikube
* GKE
* Gitlab k8s integration
* Jenkins X
* gcloud build triggers
* Helm

---
name: inverse
layout: true
class: center, middle, inverse

# Questions?

---
---
layout: false
# Materials

* [kubernetes.io](kubernetes.io)
* [EVE Online Pod](https://updates.eveonline.com/date/2017-05-06/)

    </textarea>
    <script src="https://remarkjs.com/downloads/remark-0.14.0.min.js">
    // <script src="https://remarkjs.com/downloads/remark-latest.min.js">
    </script>
    <script>
    var slideshow = remark.create();
    </script>
  </body>
</html>